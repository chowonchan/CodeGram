<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.kh.cgram.admin.mapper.AdminMapper">

	<!-- 회원 수 조회 -->
    <select id="getMemberCount" resultType="int">
        SELECT COUNT(*) FROM MEMBER
    </select>
    
    <!-- 회원 목록 조회 -->
    <select id="selectMemberList" resultType="Member">
        SELECT MEMBER_NO AS memberNo,
               MEMBER_ID AS memberId,
               MEMBER_NICKNAME AS memberNickname,
               CREATED_AT AS createdAt,
               (SELECT COUNT(*) 
                FROM BOARD 
                WHERE MEMBER_NO = M.MEMBER_NO
                AND BOARD_DEL_FL = 'N') AS boardCount,
               (SELECT COUNT(*) FROM FOLLOW WHERE FOLLOWER_MEMBER = M.MEMBER_NO) AS followCount,
               (SELECT COUNT(*) FROM FOLLOW WHERE FOLLOWING_MEMBER = M.MEMBER_NO) AS followerCount,
               MEMBER_DEL_BAN_FL AS memberDelBanFl
        FROM MEMBER M
        WHERE ADMIN NOT IN (2)
        ORDER BY MEMBER_NO ASC
        OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
    </select>
    
    <update id="updateMemberStatus">
    	UPDATE MEMBER
    	SET MEMBER_DEL_BAN_FL = CASE
    		WHEN MEMBER_DEL_BAN_FL = 1 THEN 2
    		WHEN MEMBER_DEL_BAN_FL = 2 THEN 1
    		ELSE MEMBER_DEL_BAN_FL
    	END
    	WHERE MEMBER_NICKNAME = #{memberNickname}
    </update>
	
</mapper>