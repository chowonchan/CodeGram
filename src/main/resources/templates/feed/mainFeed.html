<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CODEGRAM</title>

  <link rel="stylesheet" th:href="@{/css/mainfeed.css}">
  <link rel="stylesheet" th:href="@{/css/header.css}">
  <link rel="stylesheet" th:href="@{/css/footer.css}">
  <link rel="stylesheet" th:href="@{/css/feed/feedSlide.css}">
  <link rel="stylesheet" th:href="@{/css/feed/memberRecommend.css}">
  <link rel="stylesheet" th:href="@{/css/feed/feedStory.css}">

</head>

<body>

  <!-- 스토리 영역 -->
  <header class="stories-section">
    <!-- 스토리가 없을 때 -->
    <div th:if="${#lists.isEmpty(stories)}" class="empty-stories">
      <p>새로운 스토리가 없습니다</p>
    </div>
    <!-- 스토리가 있을 때 -->
    <div class="stories-container" th:if="${not #lists.isEmpty(stories)}">
      <!-- Story Items -->
      <div th:each="story : ${stories}" class="story-item" th:data-story-id="${story.storyNo}">
        <div class="story-wrapper" th:classappend="${board.storyCheck ? 'viewed' : ''}">
          <div class="story-border">
            <img th:src="${member.profileImg != null} ? 
                         ${member.profileImg} : '/images/default-profile.png'" class="story-profile-image">
          </div>
        </div>
        <span th:text="${story.memberNickname}" class="story-username">닉네임</span>
      </div>
    </div>

    <!-- 6개 이상일 경우 버튼 출력 -->
    <button class="nav-button prev" th:if="${#lists.size(stories != null stories : []) > 6}" 
            onclick="navigateStories('prev')"
            aria-label="이전 스토리">
      <span class="nav-icon">←</span>
    </button>
    <button class="nav-button next" th:if="${#lists.size(stories != null stories : []) > 6}" 
            onclick="navigateStories('next')"
            aria-label="다음 스토리">
      <span class="nav-icon">→</span>
    </button>
  </header>




  <!-- 사이드바 조각 -->
  <div class="header-container" th:replace="~{fragments/header :: header}"></div>

  <main>
    <div class="main-container">
      <!-- 피드 영역 - 무한 스크롤을 위한 container class 추가 -->
      <!-- 게시물이 존재하지 않을 때 -->
      <th:block th:if="${#lists.isEmpty(boardList)}">
        <p>게시글이 존재하지 않습니다.</p>
      </th:block>

      <!-- 게시물이 존재할 때 -->
      <th:block th:unless="${#lists.isEmpty(boardList)}">
        <!-- 무한스크롤 적용된 메인Feed가 나올 영역 -->
        <div class="feed-margin infinite-scroll-container">
          <!-- 게시물들이 추가될 wrapper -->
          <div class="feed infinite-scroll-wrapper">

            <!-- 로딩 인디케이터 -->
            <div class="loading-indicator" style="display: none;">
              <div class="spinner"></div>
              <p>게시물을 불러오는 중...</p>
              <!-- 코드그램 로고가 대체할 부분 -->
            </div>
          </div>
        </div>
      </th:block>

      <!-- 회원 추천 섹션 -->
      <section th:replace="~{fragments/feed/memberRecommend :: memberRecommend}"></section>
    </div>

  </main>

  <!-- 푸터 -->
  <div th:replace="~{fragments/footer :: footer}"></div>


  <script th:inline="javascript">
    // 로그인 true, 비회원 false
    const loginCheck = /*[[${session.loginMember != null}]]*/ false;
    // 로그인한 회원 닉네임
    const memberNickname = /*[[${session.loginMember?.memberNickname}]]*/ null;
    // 상세조회한 게시글 정보
    const boardDetail = /*[[${board}]]*/ null;
  </script>

  <!-- 스크립트 -->
  <script src="/js/feed/feedStory.js"></script>
  <script src="/js/feed/feedSlide.js"></script>
  <script src="/js/feed/mainfeedInfiniteScroll.js"></script>
  <script src="/js/feed/mainfeed.js"></script>
</body>

</html>