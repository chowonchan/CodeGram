<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Create New Post Modal</title>

  <style>

    /** <  ëª¨ë‹¬ì°½ ë’·ë°°ê²½ > **/
    .modal-overlay {
      user-select: none;
      position: fixed;
      top: 0;
      left: 0;

      /* íˆ¬ëª…ë„ 65%ì˜ ê²€ì •ë°°ê²½ */
      background-color: #000000a6;
      width: 100%;
      height: 100%;

      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .modal-overlay-background {
      width: 100%;
      height: 100%;

      position: absolute;
      z-index: 0;
    }

    .modal-overlay-middle {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    /** </ ëª¨ë‹¬ì°½ ë’·ë°°ê²½ > **/


    /** <  modal-close-button Css > **/
    /* ì „ì²´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */

    .modal-close-button {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      width: 34px;
      height: 34px;
      padding: 10px;

      position: absolute;
      z-index: 3;

      margin: 10px;
      top: 0;
      right: 0;
    }

    /* SVG ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .modal-close-button svg {
      width: 18px;
      height: 18px;
      fill: none; /* ë‚´ë¶€ ì±„ìš°ê¸° ì—†ìŒ */
      stroke: currentColor;
      transition: transform 0.2s, color 0.2s;
    }

    /* ì„  ìŠ¤íƒ€ì¼ */
    .modal-close-button-line-diagonal {
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-width: 3;
    }

    /* ì•„ì´ì½˜ì˜ ê¸°ë³¸ ìƒ‰ìƒ */
    .modal-close-button {
      color: #ffffff;
    }

    /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ìƒ‰ìƒ ë³€ê²½ ë° í¬ê¸° í™•ëŒ€ */
    .modal-close-button:hover {
      color: #ff9999;
      transform: scale(1.2);
    }
    /** </ modal-close-button Css > **/

    .modal-container {
      width: 734px;
      height: 777px;
      padding: 20px;

      z-index: 3;
    }

    .modal-content-top {
      width: 734px;
      height: 42px;
      background-color: #fff;
      border-bottom: solid 1px #DBDBDB;
      border-radius: 10px 10px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
    }

    .mtbtn {
      width: 50px;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;

      cursor: pointer;
    }

    .modal-content-top-next {
      font-weight: bold;
      font-size: 15px;
      color: #0095F6;
      &:hover {
        color: #0060F6;
      }
    }


    .modal-content-left {
      width: 734px;
      height: 734px;
      background-color: #fff;
      border-radius: 0 0 10px 10px;

      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .modal-content-left-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .modal-content-left-inner-button {
      width: 133px;
      height: 32px;
      background-color: #0095F6;
      color: #ffffff;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;

      border-radius: 8px;

      &:hover {
        background-color: #0050F6;
      }

    }


    .modal-content-right {
      width: 339px;
      height: 734px;
      background-color: #fff;
      border-left: solid 1px #DBDBDB;
      border-radius: 0 0 10px 0;
    }

    .modal-deep {
      border-top: solid 1px #D9D9D9;
      flex-grow: 1;
      cursor: pointer;
    }


    .hide {
      display: none !important;
    }

    .hidden {
      visibility: hidden;
      pointer-events: none;
    }

    .modal-expand {
      width: 1074px;
    }

    .fcenter {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview {
      width: 734px;
      height: 734px;
      max-width: 100%;     /* ë¶€ëª¨ ìš”ì†Œ ë„ˆë¹„ë¥¼ ë„˜ì§€ ì•ŠìŒ */
      max-height: 100%;    /* ë¶€ëª¨ ìš”ì†Œ ë†’ì´ë¥¼ ë„˜ì§€ ì•ŠìŒ */
      object-fit: contain; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì»¨í…Œì´ë„ˆì— ë§ì¶¤ */
    }

    .profile {
      width: 28px;
      height: 28px;
      object-fit: cover;
    }

  </style>
</head>
<body>

<span onclick="modalNew();" style="background-color: aquamarine; width: 100px; height: 75px; cursor: pointer;">
    ëˆ„ë¥´ë©´ ëª¨ë‹¬</span>
<h1 style="color: red;">ì‘ë™í•˜ë©´ ëƒ…ë‘¬ë¼...</h1>
<h2>ê³ ì³ì§ ë‹¹í–ˆë‹¤....</h2>
<h1>A</h1><h1>B</h1><h1>C</h1><h1>D</h1><h1>E</h1><h1>F</h1><h1>G</h1>
<h1>H</h1><h1>I</h1><h1>J</h1><h1>K</h1><h1>L</h1><h1>M</h1><h1>N</h1>


<form action="insert" method="POST" class="board-write" id="boardWriteFrm" enctype="multipart/form-data"> <!--th:object="${board}" -->
  <!-- ì‚¬ì§„ ì—…ë¡œë“œ ëª¨ë‹¬ -->
  <div id="modalOverlay" class="modal-overlay hide">

    <div id="modalOverlayBackground" class="modal-overlay-background"></div>
    <!-- ë‹«ê¸° ë²„íŠ¼ ëª¨ì–‘ ==> ëŒ€ê°ì„  ë‘ê°œë¥¼ êµì°¨í•´ì„œ ë§Œë“¤ì–´ì§ -->
    <div id="modalCloseButton" class="modal-close-button">
      <svg aria-label="ë‹«ê¸° ë²„íŠ¼ ì•„ì´ì½˜" role="img" viewBox="0 0 24 24">
        <title>Close</title>
        <polyline class="modal-close-button-line-diagonal" points="20.643 3.357 12 12 3.353 20.647"></polyline>
        <line class="modal-close-button-line-diagonal" x1="20.649" x2="3.354" y1="20.649" y2="3.354"></line>
      </svg>
    </div>

    <div id="modalOverlayMiddle" class="modal-overlay-middle">
      <div id="modalContent" class="modal-container">

        <div id="modalContentTop" class="modal-content-top">

          <div id="modalContentTopPrev" class="modal-content-top-prev mtbtn hide" >
            <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
            <svg aria-label="ë’¤ë¡œê°€ê¸° ì•„ì´ì½˜" height="24" role="img" viewBox="0 0 24 24" width="24">
              <title>Back</title>
              <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="2.909" x2="22.001" y1="12.004" y2="12.004"></line>
              <polyline fill="none" points="9.276 4.726 2.001 12.004 9.276 19.274" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></polyline>
            </svg>
          </div>

          <div id="modalContentTopText" class="modal-content-top-text" style="text-align: center; flex-grow: 1;"></div>
          <div id="modalContentTopNext" class="modal-content-top-next mtbtn hide"></div>
        </div>


        <div style="display: flex;">
          <div id="modalContentLeft" class="modal-content-left">
            <div id="modalContentLeftInner" class="modal-content-left-inner">
              <div id="modalPostNew" class="hide">
                <svg aria-label="í’ê²½ì´ë‚˜ ì¸ë¬¼ê³¼ ê°™ì€ ì‚¬ì§„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì•„ì´ì½˜" width="96" height="96" viewBox="0 0 96 77" fill="none">
                  <rect x="4" y="7.72168" width="52" height="52" rx="10" transform="rotate(-3 4 7.72168)" fill="white" stroke="black"/>
                  <path d="M7.21627 53.7294C7.21627 53.7294 13.5611 45.8327 17.6266 40.7728L28.8275 48.3253L38.3724 36.9502" stroke="black"/>
                  <circle cx="15.2431" cy="20.7012" r="4.5" transform="rotate(-3 15.2431 20.7012)" stroke="black"/>
                  <rect x="40.0117" y="17.2847" width="52" height="52" rx="10" transform="rotate(3 40.0117 17.2847)" fill="white" stroke="black"/>
                  <path d="M74.9668 36.4402C74.6995 41.5422 70.3467 45.4614 65.2448 45.194C60.1428 44.9266 56.2236 40.5739 56.491 35.4719C56.7583 30.3699 61.1111 26.4507 66.213 26.7181C71.315 26.9855 75.2342 31.3382 74.9668 36.4402Z" fill="black" stroke="black"/>
                  <path d="M56.3 48.7287L73.7783 49.6447C79.0179 49.9193 83.0427 54.3894 82.7681 59.6289L82.6111 62.6256L46.1587 60.7153L46.3158 57.7185C46.5904 52.479 51.0605 48.4541 56.3 48.7287Z" fill="black" stroke="black"/>
                </svg>
              </div>
              <div id="modalPostErr" class="hide">  <!-- jsë¡œ stroke, fill ê°’ ë³€ê²½ ê°€ëŠ¥í•œì§€ ì´í›„ í™•ì¸ -->
                <svg aria-label="íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜ ì•„ì´ì½˜"  width="96" height="96" viewBox="0 0 98 98" fill="none">
                  <circle cx="49" cy="49" r="48" stroke="black"/>
                  <circle cx="49" cy="67" r="6" stroke="black"/>
                  <path d="M51.9823 25.2558L52.7792 25.7871C53.3251 26.151 53.7665 26.651 54.0599 27.2377C54.3453 27.8087 54.4811 28.4427 54.4545 29.0805L53.5298 51.2749C53.5123 51.6954 53.4358 52.1113 53.3028 52.5106L53.0682 53.2144C52.7517 54.1637 52.1279 54.9805 51.2952 55.5356L50.5547 56.0293C50.0943 56.3362 49.5533 56.5 49 56.5C48.4467 56.5 47.9057 56.3362 47.4453 56.0293L46.7048 55.5356C45.8721 54.9805 45.2483 54.1637 44.9318 53.2144L44.6972 52.5106C44.5642 52.1113 44.4877 51.6954 44.4702 51.2749L43.5455 29.0805C43.5189 28.4427 43.6547 27.8087 43.9401 27.2377C44.2335 26.651 44.6749 26.151 45.2208 25.7871L46.0177 25.2558C46.7569 24.763 47.6255 24.5 48.5139 24.5H49.4861C50.3745 24.5 51.2431 24.763 51.9823 25.2558Z" stroke="black"/>
                </svg>
              </div>

              <div id="modalContentLeftInnerText" class="modal-content-left-inner-text" style="font-size: 20px; padding: 14px;"></div>
              <div id="modalContentLeftInnerErr" class="modal-content-left-inner-err hidden" style="font-size: 15px; padding: 10px; color: #737373"></div>
              <div id="modalContentLeftInnerButton" class="modal-content-left-inner-button"></div>

            </div>

            <!-- ì´ë¯¸ì§€ ì¶œë ¥ë¶€ë¶„ -->
            <div id="modalContentLeftImg" class="modal-content-left-img hide" style="width: 100%; height: 100%;">
              <div id="modalContentLeftImgView" class="modal-content-left-img-view"><!-- ì—¬ê¸°ì„œë¶€í„° ê¼¬ì˜€ìŒ ====================================================== JSJSJSJSJSJSJSJSJSJ -->
                <img class="preview" src="">
                <input type="file" name="images" id="modalContentLeftInnerImg" class="modal-content-left-inner-button hide" accept="image/*" multiple>
              </div>
              <div id="modalContentLeftImgList" class="modal-content-left-img-list"></div>
            </div>
          </div>

          <!-- ëª¨ë‹¬ ê¸€ì“°ê¸° -->
          <div id="modalContentRight" class="modal-content-right hide">
            <div id="modalContentScrollable" style="width: 100%; height: 100%; overflow-y: auto; background-color: ivory; display: flex; flex-direction: column;" >

              <!-- ê¸€ ì‘ì„±ì ì¶œë ¥ -->
              <div style="width: 290px; height: 60px; ">

                <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
                <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ ì¶œë ¥ -->
                <!-- <img th:unless="${board.profileImg}" th:src="#{user.default.image}"> -->

                <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìˆì„ ê²½ìš° ì¶œë ¥ -->
                <!-- <img th:if="${board.profileImg}" th:src="${board.profileImg}"> -->
                <!-- <span th:text="${board.memberNickname}">ì‘ì„±ì ë‹‰ë„¤ì„</span> -->

                <!-- ì„¸ì…˜ì—ì„œ ë°›ì•„ì˜¤ëŠ” ë°©ë²•ìœ¼ë¡œ -->
                <img th:unless="${session.profileImg}" th:src="#{user.default.image}" class="profile">
                <img th:if="${session.profileImg}" th:src="${session.profileImg}" class="profile">
                <span th:text="${session.loginMember.memberNickname}">ì‘ì„±ì ë‹‰ë„¤ì„</span>
              </div>

              <!-- ê¸€ ì‘ì„±ë¶€ë¶„ -->
              <div style="padding: 16px;">
                <textarea style="width: 100%; height: 400px; resize: none;" id="emojiTextArea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
              </div>

              <!-- ì´ëª¨ì§€ ë²„íŠ¼ê³¼ ê¸€ììˆ˜ ì¶œë ¥ë¶€ë¶„ -->
              <div style="width: 339px; display: flex; justify-content: space-between;">
                <div style="cursor: pointer;" id="trigger">ğŸ™‚</div>
                <p><span id="byteCount">0</span>/2000</p>
              </div>

              <div>ë§¨ì•„ë˜ 24px ë†’ì´ ì—¬ë°±</div>

            </div>
          </div>

        </div>
      </div>
    </div>


    <!-- 2nd ëª¨ë‹¬ -->
    <div id="modalContentDeep" class="modal-overlay hide" style="z-index: 5;">
      <div id="modalContentDeepBackground" class="modal-overlay-background"></div>
      <div style="width: 400px; height: 202px; background-color: #fff; border-radius: 11px; display: flex; flex-direction: column; z-index: 7;">
        <div class="fcenter" style="width: 100%; height: 106px; display: flex; flex-direction: column;">
          <div style="padding: 5px; font-size: 20px; font-weight: bold;">ê²Œì‹œê¸€ ì‘ì„±ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
          <div style="padding: 5px; font-size: 15px; color: #737373;" >ì§€ê¸ˆ ë‚˜ê°€ë©´ ì‘ì„± ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>
        <div id="modalContentDeepConfirm" class="fcenter modal-deep" style="color: #ED4956;">í™•ì¸</div>
        <div id="modalContentDeepCancel" class="fcenter modal-deep">ì·¨ì†Œ</div>
      </div>
    </div>

  </div>
</form>
<!-- ======================================================================================================================================================================================================== -->
<script src="https://unpkg.com/picmo@latest/dist/umd/index.js"></script>
<script src="https://unpkg.com/@picmo/popup-picker@latest/dist/umd/index.js"></script>
<script>

  const modalOverlay = document.getElementById("modalOverlay");

  const modalContent = document.getElementById("modalContent");
  const modalContentDeep = document.getElementById("modalContentDeep");

  const modalTop = document.getElementById("modalContentTop");
  const modalTopPrev = document.getElementById("modalContentTopPrev");
  const modalTopText = document.getElementById("modalContentTopText");
  const modalTopNext = document.getElementById("modalContentTopNext");

  const modalLeft = document.getElementById("modalContentLeft");
  const modalRight = document.getElementById("modalContentRight");


  let filename = "ë“±ë¡ ì‹œë„í•œ íŒŒì¼ì˜ ì´ë¦„.í™•ì¥ì"
  let flag = 0;
  // ì´ë²¤íŠ¸ ê²½ìš°ì˜ ìˆ˜ê°€ ë„ˆë¬´ ë§ë‹¤.......................................................................
  // ì•„ì•„ì•„ì•„ì•„ì•….......................................................................................


  // ë°œìƒ ë¬¸ì œ ==> Xë²„íŠ¼ì´ë‚˜ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ê»ë‹¤ê°€ ë‹¤ì‹œì¼œë©´ ì‘ì„±ì¤‘ì´ë˜ í™”ë©´ì´ ë‚˜ì˜´
  // ==> ì§€ìš°ê±°ë‚˜ ë³€ê²½í•œ ê°’ë“¤ì„ ëª¨ì¡°ë¦¬ ì´ˆê¸°í™” ì‹œì¼œì¤„ ìˆ˜ ìˆì–´ì•¼ í•¨ ==> íŒŒì¼ ì„ íƒë¶€ë¶„ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í˜¸ì¶œë¶€ë¶„ì€ ìˆ˜ì •í•˜ì˜€ìŒ

  // ==> modal top ê°’ì„ ì•„ë˜ left + right valueë¡œ ë³€ê²½í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°”ê¾¸ê³ 

  // ëª¨ë‹¬ X ë²„íŠ¼ í´ë¦­
  document.getElementById("modalCloseButton").addEventListener("click", () => {

    modalCloseAlert();

  });

  document.getElementById("modalContentDeepBackground").addEventListener("click", () => {
    modalContentDeep.classList.add('hide');
  })

  // ëª¨ë‹¬ ë°˜íˆ¬ëª… ë°°ê²½ í´ë¦­
  document.getElementById("modalOverlayBackground").addEventListener("click", () => {

    modalCloseAlert();

  });

  let modalProgress = 1;
  // 0. ì—ëŸ¬
  // 1. ì´ˆê¸°
  // 2. ìˆœì„œë³€ê²½
  // 3. ì´ë¯¸ì§€ í¸ì§‘
  // 4. ê¸€ ë“±ë¡

  // ì´ë²¤íŠ¸ ë„£ì„ë•ŒëŠ” ë§¤ìš° ì‹ ì¤‘í•˜ê²Œ!

  function modalNew() {
    // ëª¨ë‹¬ ì´ˆê¸°ê°’ ì§€ì •
    // top ê°€ë¡œ, content ê°€ë¡œ, right display: none;
    // ìƒë‹¨ í…ìŠ¤íŠ¸, ë‚´ë¶€ ì´ë¯¸ì§€, ë‚´ë¶€ í…ìŠ¤íŠ¸, ë²„íŠ¼ ê¸€ì
    modalContent.style.width = "734px";
    modalTop.style.width = "734px";
    modalRight.classList.add("hide");

    modalOverlay.classList.remove("hide");
    document.getElementById("modalContentLeftInner").classList.remove("hide");
    document.getElementById("modalPostNew").classList.remove("hide");
    document.getElementById("modalPostErr").classList.add("hide");
    document.getElementById("modalContentLeftInnerErr").classList.add("hidden");
    document.getElementById("modalContentLeftImg").classList.add("hide");


    modalTopNext.classList.add("hide");
    modalTopPrev.classList.add("hide");

    modalTopText.innerText = "ìƒˆ ê²Œì‹œë¬¼ ë§Œë“¤ê¸°";
    document.getElementById("modalContentLeftInnerText").innerText = "ì‚¬ì§„ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”."
    document.getElementById("modalContentLeftInnerButton").innerText = "ì»´í“¨í„°ì—ì„œ ì„ íƒ"

    modalProgress = 1;
    disableScroll();
  }

  function modalError() {
    // ìƒë‹¨ í…ìŠ¤íŠ¸, ë‚´ë¶€ ì´ë¯¸ì§€, ë‚´ë¶€ í…ìŠ¤íŠ¸, ë²„íŠ¼ ê¸€ì
    modalContent.style.width = "734px";
    modalTop.style.width = "734px";
    document.getElementById("modalPostNew").classList.add("hide");
    document.getElementById("modalPostErr").classList.remove("hide");
    document.getElementById("modalContentLeftImg").classList.add("hide");

    modalTopNext.classList.add("hide");
    modalTopPrev.classList.add("hide");

    modalTopText.innerText = "ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤";
    document.getElementById("modalContentLeftInnerText").innerText = "ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ì…ë‹ˆë‹¤."
    document.getElementById("modalContentLeftInnerErr").innerText = filename + " íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤."
    document.getElementById("modalContentLeftInnerErr").classList.remove("hidden");

    document.getElementById("modalContentLeftInnerButton").innerText = "ë‹¤ë¥¸ íŒŒì¼ ì„ íƒ"

    modalProgress = 0;
  }

  function modalWithImg() {
    // ìƒë‹¨ í…ìŠ¤íŠ¸ ë³€ê²½ ë° ë²„íŠ¼ ì¢Œ, ìš° ìƒì„±
    // ë‚´ë¶€ ì´ë¯¸ì§€, ë‚´ë¶€ í…ìŠ¤íŠ¸, ë²„íŠ¼ ê¸€ì ì œê±°
    document.getElementById("modalContentLeftInner").classList.add("hide");
    document.getElementById("modalContentLeftImg").classList.remove("hide");

    modalTopNext.classList.remove("hide");
    modalTopPrev.classList.remove("hide");

    modalContent.style.width = "734px";
    modalTop.style.width = "734px";
    modalRight.classList.add("hide");


    modalTopText.innerText = "ì´ë¯¸ì§€ ìˆœì„œ ë³€ê²½";
    document.getElementById("modalContentTopNext").innerText = "ë‹¤ìŒ"
    document.getElementById("modalContentTopNext").style.width = "50px";

    modalProgress = 2;
  }

  /*   function modalImgEdit() {
    // top ê°€ë¡œ, content ê°€ë¡œ, right display:none classList Remove
  } */

  // ëª¨ë‹¬ ì „ì²´ ì´ˆê¸°í™” í•¨ìˆ˜
  function clearProgress() {

    // ì €ì¥ëœ ì´ì „ íŒŒì¼ ëª©ë¡ ì‚­ì œ
    for (let k = 0; k < lastValidFiles.length; i++) lastValidFiles[i].value = "";

    // ì‚½ì…ëœ ì´ë¯¸ì§€ ë°°ì—´ ì´ˆê¸°í™”
    for (let j = 0; j < inputImageList.length; i++) inputImageList[i].value = ""; 

    // ê°€ë¡œ ì„¸ë¡œ hide hidden, ë²„íŠ¼, í…ìŠ¤íŠ¸ ë“± ì‹¹ ì´ˆê¸°í™”
  }

  function modalWrite() {
    // right ì— ê²Œì‹œê¸€ ì‘ì„±ë‚´ìš©
    //ìƒˆ ê²Œì‹œë¬¼ ë§Œë“¤ê¸°
    modalContent.style.width = "1074px";
    modalTop.style.width = "1074px";
    modalLeft.style.borderRadius = "0 0 0 10px";
    modalRight.classList.remove("hide");
    modalTopText.innerText = "ê²Œì‹œê¸€ ë“±ë¡";
    document.getElementById("modalContentTopNext").innerText = "ê³µìœ í•˜ê¸°";
    document.getElementById("modalContentTopNext").style.width = "80px";

    modalProgress = 4;
  }

  document.getElementById("modalContentTopPrev").addEventListener("click", () => {
    console.log("ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ : ", modalProgress);
    switch(modalProgress) {
      case 2 : modalCloseAlert(); break;
            // case 3 : modalWithImg(); break;
            // case 4 : modalImgEdit(); break;
      case 4 : modalWithImg(); break;
      default : console.log("ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­"); break;
    }
  });

  document.getElementById("modalContentTopNext").addEventListener("click", () => {
    switch(modalProgress) {
      case 2 : modalWrite(); break;
            // case 2 : modalImgEdit(); break;
            // case 3 : modalWrite(); break;
//========================================================================
      case 4 : submitForm();

      default : console.log("ë‹¤ìŒ ë²„íŠ¼ í´ë¦­"); break;
    }
  });

  function modalCloseAlert() {
    if(modalProgress > 1) {
      modalContentDeep.classList.remove("hide");
      return;
    }
    modalOverlay.classList.add("hide");
    enableScroll();
  }

  document.getElementById("modalContentDeepConfirm").addEventListener("click", () => {
    modalContentDeep.classList.add("hide");
    modalOverlay.classList.add("hide");
    enableScroll();
  });

  document.getElementById("modalContentDeepCancel").addEventListener("click", () => {
    modalContentDeep.classList.add("hide");
  });




  // ìŠ¤í¬ë¡¤ì„ ë°©ì§€í•˜ëŠ” í•¨ìˆ˜
  function preventScroll(e) {
    e.preventDefault();
  }

  // ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
  function disableScroll() {
    document.addEventListener('wheel', preventScroll, { passive: false });
  }

  // ìŠ¤í¬ë¡¤ í™œì„±í™”
  function enableScroll() {
    document.removeEventListener('wheel', preventScroll);
  }

  function enableElementScroll(element) {
    element.addEventListener('wheel', function(e) {
      // ì´ ë¶€ë¶„ë„ ì¶”í›„ ìˆ˜ì • (ë¬¸ì„œ ë†’ì´ê°€ 0ì¼ë•Œ ìœ„ë¡œ ìŠ¤í¬ë¡¤í•  ê²½ìš° ë°”ê¹¥ ìŠ¤í¬ë¡¤ ë˜ì§€ ì•Šê³ , ë¬¸ì„œ ë†’ì´ê°€ ë°”ë‹¥ì¼ ê²½ìš°ì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì ìš©ë˜ê²Œë”)
      // ëª¨ë‹¬ì°½ì´ ì—´ë¦¬ë©´, ì „ì²´ í˜ì´ì§€ì—ì„œ ìŠ¤í¬ë¡¤ì„ í•  ìˆ˜ ì—†ë„ë¡ í•˜ê³ 
      // ê¸€ì“°ê¸° ëª¨ë‹¬ì°½ ìš°ì¸¡ë¶€ë¶„ì—ì„œë§Œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
      if (element.scrollHeight > element.clientHeight) {
        e.stopPropagation();
      }
    }, { passive: false });
  }
  enableElementScroll(document.getElementById('modalContentScrollable'));
  enableElementScroll(document.getElementById('trigger'));

  // ====================================================================================================


  // ì´ë¯¸ì§€ ì‚½ì… ê´€ë ¨ script
  function isSupportedFile(file) {
    const allowedTypes = ["image/jpeg", "image/png", "image/gif"];
    return allowedTypes.includes(file.type);
  }

  const maxSize = 1024 * 1024 * 10;  // 10MBë¥¼ byte ë‹¨ìœ„ë¡œ ì‘ì„±
  // ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 10ì¥ê¹Œì§€
  // const lastValidFiles = [null, null, null, null, null, null, null, null, null, null];
  const lastValidFiles = [null, null, null, null, null];

  // ì‚¬ì§„ ì¶”ê°€ ë²„íŠ¼ í´ë¦­
  document.getElementById("modalContentLeftInnerButton").addEventListener("click", () => {
    document.getElementById("modalContentLeftInnerImg").click();
  });

  document.getElementById("modalContentLeftInnerImg").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file && isSupportedFile(file)) {
      // íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ
      console.log("File uploaded:", file.name);
      console.log("File:", file);
      modalWithImg();
    } else if(file && !isSupportedFile(file)) {
      filename = file.name;
      modalError();
    }
  });

  const inputImageList = document.getElementsByClassName("modal-content-left-img-view");
  const previewList = document.getElementsByClassName("preview");
  /**
   * ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
   * @param file  : <input type="file"> ì—ì„œ ì„ íƒëœ íŒŒì¼
   * @param order : ì´ë¯¸ì§€ ìˆœì„œ
   */
  const updatePreview = (file, order) => {  // ì´ë¯¸ì§€ ìˆœì„œê¹Œì§€ ì–»ì–´ì™€ì•¼

    // ì„ íƒëœ íŒŒì¼ì´ ì§€ì •ëœ í¬ê¸°ë¥¼ ì´ˆê³¼í•œ ê²½ìš°ì„ íƒ ë§‰ê¸°
    const maxSize = 1024 * 1024 * 10;  // 10MBë¥¼ byte ë‹¨ìœ„ë¡œ ì‘ì„±

    if(file.size > maxSize) {   // íŒŒì¼ í¬ê¸° ì´ˆê³¼ ì‹œ
      alert("10MB ì´í•˜ì˜ ì´ë¯¸ì§€ë§Œ ì„ íƒí•´ ì£¼ì„¸ìš”");

      /* ë¯¸ë¦¬ë³´ê¸°ëŠ” ë§‰ì•˜ëŠ”ë°, ì—…ë¡œë“œ íŒŒì¼ì—ëŠ” í¬ê¸°ê°€ ì´ˆê³¼ëœ íŒŒì¼ì´ ì„ íƒë˜ì–´ì ¸ ìˆìŒ!! */
      // ì´ì „  ì„ íƒëœ íŒŒì¼ì´ ì—†ëŠ”ë°, í¬ê¸° ì´ˆê³¼ íŒŒì¼ì„ ì„ íƒí•œ ê²½ìš°
      if(lastValidFiles[order] === null) {
        // if(lastValidFiles === null) {
        inputImageList[order].value = ""; // ì„ íƒ íŒŒì¼ ì‚­ì œ
        // inputImageList.value = ""; // ì„ íƒ íŒŒì¼ ì‚­ì œ
        return;
      }

      // ì´ì „ ì„ íƒëœ íŒŒì¼ì´ ìˆì„ ë•Œ
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(lastValidFiles[order]);
      // dataTransfer.items.add(lastValidFiles);
      inputImageList[order].files = dataTransfer.files;
      // inputImageList.files = dataTransfer.files;

      return;
    }


    // ì„ íƒëœ ì´ë¯¸ì§€ ë°±ì—…
    lastValidFiles[order] = file;

    // JS ì—ì„œ ì œê³µí•˜ëŠ” íŒŒì¼ì„ ì½ì–´ì˜¤ëŠ” ê°ì²´
    const reader = new FileReader();

    // íŒŒì¼ì„ ì½ì–´ ì˜¤ëŠ”ë°
    // DataURL í˜•ì‹ìœ¼ë¡œ ì½ì–´ì˜´
    // DataURL : íŒŒì¼ ì „ì²´ ë°ì´í„°ê°€ ë¸Œë¼ìš°ì €ê°€ í•´ì„í•  ìˆ˜ ìˆëŠ” ê¸´ ì£¼ì†Œí˜•íƒœ ë¬¸ìì—´ë¡œ ë°˜í™˜
    reader.readAsDataURL(file);

    reader.addEventListener("load", e => {
      previewList[order].src = e.target.result;
      // e.target.result == íŒŒì¼ì´ ë³€í™˜ëœ ì£¼ì†Œ í˜•íƒœ ë¬¸ìì—´
    });
  }

  for(let i = 0; i < inputImageList.length; i++) {

    // input íƒœê·¸ì— ì´ë¯¸ì§€ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜ í˜¸ì¶œ
    inputImageList[i].addEventListener("change", e => {
//================================================================================================================
// ì—¬ê¸°ë¥¼ ìˆ˜ì •í•´ì„œ createElement ë¥¼ ìƒì„±í•œë‹¤!
// ê·¸ëŸ°ë° ì´ë¯¸ ìˆëŠ” íŒŒì¼ì€ ì–´ë–»ê²Œ?
//================================================================================================================
      const file = e.target.files[i];


      console.log(file)

      if(file === undefined) {    // ì„ íƒ ì·¨ì†Œ ì‹œ
        // ì´ì „ì— ì„ íƒí•œ íŒŒì¼ì´ ì—†ëŠ” ê²½ìš°
        if(lastValidFiles[i] === null) return;

        // ** ì´ì „ì— ì„ íƒí•œ íŒŒì¼ì´ "ìˆì„" ê²½ìš° **
        const dataTransfer = new DataTransfer();

        // DataTransfer ê°€ ê°€ì§€ê³  ìˆëŠ” files í•„ë“œì—
        // lastValidFiles[i] ì¶”ê°€
        dataTransfer.items.add(lastValidFiles[i]);

        // inputì˜ files ë³€ìˆ˜ì— lastValidFileì´ ì¶”ê°€ëœ files ëŒ€ì…
        inputImageList[i].files = dataTransfer.files;

        // ì´ì „ ì„ íƒëœ íŒŒì¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ë˜ëŒë¦¬ê¸°
        updatePreview(lastValidFiles[i], i);

        return;
      }

      updatePreview(file, i);
    });
  }

  //========================================================================
  // ê¸€ì“°ê¸° ë¶€ë¶„
  const { createPopup } = window.picmoPopup;
  const MAX_BYTES = 2000; // ìµœëŒ€ ë°”ì´íŠ¸ ì œí•œ
  const textArea = document.getElementById('emojiTextArea');
  const byteCount = document.getElementById('byteCount');

  document.addEventListener('DOMContentLoaded', () => {
    const trigger = document.querySelector('#trigger');

    const picker = createPopup({}, {
      referenceElement: trigger,
      triggerElement: trigger,
      position: 'right-end'
    });


    trigger.addEventListener('click', () => {
      picker.toggle();
    });

    picker.addEventListener('emoji:select', (selection) => {
      textArea.value += selection.emoji;
      byteCount.textContent = byteLength(textArea.value); // UTF-8ë¡œ ê³„ì‚°ëœ ë°”ì´íŠ¸ ìˆ˜
      textArea.focus(); // í…ìŠ¤íŠ¸ ì˜ì—­ì— í¬ì»¤ìŠ¤ë¥¼ ë§ì¶°ì¤Œ
    });
  });

  // UTF-8 ë°”ì´íŠ¸ ê³„ì‚° í•¨ìˆ˜
  function byteLength(str) {
    let bytes = 0;
    for (let i = 0; i < str.length; i++) {
      const code = str.charCodeAt(i);
      if (code <= 0x7F) {
        bytes += 1; // ASCII
      } else if (code <= 0x7FF) {
        bytes += 2; // 2ë°”ì´íŠ¸
      } else if (code <= 0xFFFF) {
        bytes += 3; // 3ë°”ì´íŠ¸
      } else {
        bytes += 4; // 4ë°”ì´íŠ¸ (Surrogate pair)
      }
    }
    return bytes;
  }

  textArea.addEventListener('input', () => {
    byteCount.textContent = byteLength(textArea.value); // UTF-8ë¡œ ê³„ì‚°ëœ ë°”ì´íŠ¸ ìˆ˜
  });


  textArea.addEventListener('input', () => {
    if (byteLength(textArea.value) > MAX_BYTES) {
      // ë°”ì´íŠ¸ ì´ˆê³¼ ì‹œ ì´ˆê³¼ ë¶€ë¶„ ì œê±°
      while (byteLength(textArea.value) > MAX_BYTES) {
        textArea.value = textArea.value.slice(0, -1);
      }
    }

    // í˜„ì¬ ë°”ì´íŠ¸ ìˆ˜ ì—…ë°ì´íŠ¸
    byteCount.textContent = byteLength(textArea.value);
  });

  //=======================================================
  // ì œì¶œ

  async function submitForm() {

    const formData = new FormData();
    const textAreaContent = document.getElementById("emojiTextArea").value;
    const files = document.getElementById("modalContentLeftInnerImg").files;

    formData.append("boardContent", textAreaContent);
    
    for (let i = 0; i < files.length; i++) {
      formData.append("images", files[i]);
    }

    try {
      const response = await fetch("/submitFeed", {  
        method: "POST",
        body: formData,
        headers: {
          // ì˜ˆì‹œ: Authorization í—¤ë”ë‚˜ ì¶”ê°€ì ì¸ í—¤ë”ê°€ í•„ìš”í•  ê²½ìš° ì—¬ê¸°ì— ì¶”ê°€
          'Authorization': 'Bearer ' + localStorage.getItem('accessToken')  // í† í° ì˜ˆì‹œ
        }
      });

      if (response.ok) {
        const result = await response.text();
        if(result > 0) {
          alert("ê²Œì‹œë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");

        }
        // ëª¨ë‹¬ ë‹«ê¸°, í™”ë©´ ì´ˆê¸°í™” ë“± ì¶”ê°€ ì‘ì—…
        else alert("ê²Œì‹œë¬¼ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    } catch (error) {
      console.error("Error submitting form:", error);
      alert("ì„œë²„ì™€ì˜ í†µì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
  }

</script>
</body>
</html>

<!-- íŒŒì¼ ì²¨ë¶€, ì´ë¯¸ì§€ ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½, ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìºëŸ¬ì…€ì˜ ìˆœì„œëŠ” ë“œë˜ê·¸ë¥¼ ë”°ë¼ê°€ë„ë¡, 
     ê²Œì‹œê¸€ ë“±ë¡ê¸€ ê¸€ììˆ˜ ì¹´ìš´íŠ¸ ì´ë²¤íŠ¸ , ê²Œì‹œê¸€ ë“±ë¡ ë°±ì—”ë“œ ë§ˆë¬´ë¦¬ + ì´ëª¨ì§€ ë²„íŠ¼ ì´ë²¤íŠ¸ ìˆ˜ì • ë° ì ìš© -->


<!-- // <form enctype="multipart/form-data" method="POST" role="presentation"><input accept="image/jpeg,image/png,image/heic,image/heif" multiple="" type="file"></form> -->